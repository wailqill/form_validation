<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <script src="../lib/prototype.js" type="text/javascript" charset="utf-8"></script>
  <script src="../lib/unittest.js" type="text/javascript" charset="utf-8"></script>
  <link rel="stylesheet" href="../lib/test.css" type="text/css" media="screen" charset="utf-8">

  <script src="../src/wq.form_validator.js" type="text/javascript" charset="utf-8"></script>
	<title>Form.Validator: elements tests</title>
	
</head>

<body>
  <h2>Elements tests</h2>

<!-- Log output -->
<div id="testlog"></div>

<script type="text/javascript" charset="utf-8">
// <![CDATA[
var fv = null;
new Test.Unit.Runner({
	setup: function() {
	},
	teardown: function() {
	},
  test_class_should_exist: function() {
    this.assert(wq.Form.Validation.Element);
  },
  test_should_have_static_remove_method: function() {
    this.assertRespondsTo("remove", wq.Form.Validation.Element);
  },
  test_element_ctor_should_allow_for_string_and_obj_as_elements_and_expose_element: function() {
    var elm = new wq.Form.Validation.Element($("person_name"));
    this.assertEqual(elm.element, $("person_name"));
    var elm = new wq.Form.Validation.Element("person_name");
    this.assertEqual(elm.element, $("person_name"));
  },
  test_should_have_validate_method_returning_boolean: function() {
    var elm = $("person_name");
    var fve = new wq.Form.Validation.Element(elm, { required: true });
    this.assertRespondsTo("validate", fve);
    this.assertEqual(false, fve.validate());
    elm.value = "Hello world";
    this.assertEqual(true, fve.validate());
    wq.Form.Validation.Element.remove(fve); // teardown
  },
  test_should_have_errors_collection: function() {
    $("person_name").value = "";
    var fve = new wq.Form.Validation.Element("person_name", { required: true });
    this.assertInstanceOf(Hash, fve.errors);
    fve.validate();
    this.assertEqual(1, fve.errors.keys().length);
    this.assertEqual("required", fve.errors.keys().first());
    // And make sure it's cleared between validations
    fve.validate();
    this.assertEqual(1, fve.errors.keys().length);
    
    wq.Form.Validation.Element.remove(fve); // teardown
  },
  test_add_error_message_container_and_only_once: function() {
    var elm = $("person_name");
    elm.value = "";
    var fve = new wq.Form.Validation.Element(elm, { required: true });
    this.assertNull(elm.next("span.fv_error"));
    fve.validate();
    this.assertNotNull(elm.next("span.fv_error"));
    fve.validate();
    this.assertNull(elm.next("span.fv_error").next("span.fv_error"));
    wq.Form.Validation.Element.remove(fve); // teardown
  },
  test_remove_error_message_container: function() {
    var elm = $("person_name");
    elm.value = "";
    var fve = new wq.Form.Validation.Element(elm, { required: true });
    fve.validate();
    this.assertNotNull(elm.next("span"));
    wq.Form.Validation.Element.remove(fve);
    this.assertNull(elm.next("span"));
  }
});

// ]]>
</script>

<form action="index_submit" method="get" accept-charset="utf-8" id="my-form">
  <p>
    <label for="name">Name</label><input type="text" name="person[name]" value="" id="person_name">
  </p>
  <p>
    <label for="email">Email</label><input type="text" name="person[email]" value="" id="person_email">
  </p>
  <p>
    <label for="date">Date</label><input type="text" name="person[date]" value="" id="person_date">
  </p>
  
  <p><input type="submit" value="Continue &rarr;"></p>
</form>

</body>
</html>
